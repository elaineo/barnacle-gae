<div class="row-fluid">
  <div class="span8 offset1 btn-group">
  {% if is_receiver == True %}
  <button type="submit" class="button info" id="viewprof_btn">View {{sender_first_name}}'s Profile</button>
  {% endif %}
  <button type="submit" class="button info" id="viewroute_btn">View {{receiver_first_name}}'s Request</button>
  {% if is_receiver == True or is_sender == True %}{% if msg_ok == True %}
  <button type="submit" class="button info" id="sendmsg_btn">Send Message</button>
  {% endif %}{% endif %}
  
  {% if confirm_allow %}
  <button type="submit" class="button primary confirm" id="confirmres_btn">Confirm</button>
  <button type="submit" class="button secondary decline" id="decline_btn">Decline</button>
  {% endif %}
  </div>
</div>
<div class="row"><div class="span8 offset1 hide" id="msgSent"><p>Message Sent!</p></div></div>
<div class="row-fluid">
  <div class="span8 offset1 hide" id="createNewMsg">
    <p>
      <div class="control-group">
      <label class="control-label" for="msg">Message:</label>
        <div class="controls">
          <textarea class="input-xxlarge" rows="5" name="msg" id="msgReserve">{{msg}}</textarea>
        </div><button type="submit" class="button info small" id="submitmsg_btn">send</button>
        </div>    
    </p>
  </div>
</div>

  
<script type="text/javascript">
$(document).ready(function(){
    var allowSub = true;
    click_redirect('#viewprof_btn','{{sender_profile_url}}');
    click_redirect('#viewroute_btn','{{post_url}}');
    click_redirect('#editres_btn','{{edit_url}}');
    add_confirmation_dialog('{{confirm_url}}',"confirmres_btn");
    add_confirmation_dialog('{{delete_url}}',"delete_btn");
    add_confirmation_dialog('{{decline_url}}',"decline_btn");
    $('#sendmsg_btn').click(function() { 
        $('#msgSent').addClass('hide');
        $('#createNewMsg').toggleClass('hide'); });
    $('#submitmsg_btn').click(function() { 
        if (allowSub) { 
            sendmsg(); 
            allowSub=false;
        }});
});

function dumpmsgs() {
    $.getJSON('{{message_url}}', function(msgs){
        var mcontent = '<table class="dumpsm" cellpadding="10" cellspacing="10"><tr height="10px"><td width="150px">&nbsp;</td></tr>';
        for (m in msgs) {
            mcontent = mcontent+ '<tr><td rowspan="3"><a href="'+msgs[m].sender_prof_url+
            '"><img src="'+msgs[m].sender_thumb+'"><br>'+
            msgs[m].sender+'</a><br><span class="xsm">'+msgs[m].created+'</span></td>'+
            '<td>'+msgs[m].msg+'</td></tr>';
        }
        mcontent=mcontent+'</table>';
        $('#dumpmsgs').html(mcontent);            
        $('#viewmsgs_btn').html('Hide Messages');
    });
}
function sendmsg() {
  var msg = $('#msgReserve').val();
  $('#msgReserve').val('');
  $.ajax({
    type: "POST",
    url: "{{send_message_url}}",
    data: "msg="+msg,
    success: function(response) {
        $('#createNewMsg').addClass('hide');
        $('#msgSent').removeClass('hide');
    }
  });
}
</script>