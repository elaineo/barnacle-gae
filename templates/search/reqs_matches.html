{% extends "base.html" %}
{% block title%}Requests and Matches{% endblock %}
{% block heading%}<h1>Requests and Matches</h1>{% endblock %}
{% block content %}

<div class="row-fluid">
  <div class="span10 offset1">
    <p>
    Click on match number to see matches. Click on request to view page.
    </p>
  </div>
</div>

<div class="row-fluid">
  <div class="span10 offset1">
    <h3>Delivery Requests</h3>
    <table class="table table-striped table-hover">
    <thead><tr>
        <th>Origin/Destination</th>
        <th>Deliver By</th>
        <th>Offer</th>
        <th>Matches</th>
    </tr></thead>
    {% for req in reqdump %}
    <tr>
        <td class='clicky' onclick="document.location.href = '{{req.post_url}}';">{{req.locstart}} to {{req.locend}}      
        </td>
        <td>{{req.delivby}}</td>
        <td>{{req.rates}}</td>
        {% if req.num_matches!=0 %}
        <td style='text-align:center'><button class='btn btn-small btn-primary showoff'>{{req.num_matches}}</button></td>
        {% else %}
        <td style='text-align:center'>{{req.num_matches}}</td>
        {% endif %}
    </tr>
    {% if req.num_matches!=0 %}
    <tr class='hide'><td colspan='4'>
        <table class='table-mini'>
        <thead><tr>
        <td>Start</td>
        <td>Dest</td>
        <td>Arrival</td>
        </tr></thead>
        {% for r in req.matches %}
        <tr class='clicky' onclick="document.location.href = '{{r.post_url}}';">
            <td>{{r.locstart}}</td>
            <td>{{r.locend}}</td>
            <td>{{r.delivend}}</td>
        </tr>
        {% endfor %}
        </table>
    {% endif %}
    {% endfor %}
     </table>    
  </div>
</div>

<script>
$(document).ready(function(){
    $('.showres').click(function() {
        var row = $(this).closest('tr').next();
        row.toggleClass('hide');
    });
    $('.showoff').click(function() {
        var row = $(this).closest('tr').next();
        row.toggleClass('hide');
    });    
});
</script>
{% endblock %}